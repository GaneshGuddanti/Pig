data loading


-- Load the cleaned dataset with 15 fields
data = LOAD '/home/gg7hz/Cleaned_data.tsv' 
       USING PigStorage('\t') 
       AS (marketplace:chararray, customer_id:chararray, review_id:chararray, product_id:chararray, 
           product_parent:chararray, product_title:chararray, product_category:chararray, star_rating:int, 
           helpful_votes:int, total_votes:int, vine:chararray, verified_purchase:chararray, 
           review_headline:chararray, review_body:chararray, review_date:chararray);

1.a. -- Group data by marketplace and product_category
grouped_data = GROUP data BY (marketplace, product_category);

-- Calculate the total number of review_id and average star_rating
result_1 = FOREACH grouped_data GENERATE 
            FLATTEN(group) AS (marketplace, product_category),
            COUNT(data.review_id) AS total_reviews,
            AVG(data.star_rating) AS avg_star_rating;

-- Dump the result for Task 1.1
DUMP result_1;

1.b. -- Filter out records where marketplace is 'US'
filtered_result = FILTER result_1 BY marketplace != 'US';

-- Dump the result for Task 1.2
DUMP filtered_result;
